<%= form_with model: message, url: messages_path, method: :post, data: { controller: "message" } do |form| %>

  <% if message.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(message.errors.count, "error") %> prohibited this message from being saved:</h2>

      <ul>
        <% message.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Template Selection -->
  <%= label_tag :template_id, "Choose a template" %>
  <%= select_tag :template_id, 
        options_from_collection_for_select(MessageTemplate.all, :id, :title), 
        prompt: "Select a template", 
        data: { action: "change->message#loadTemplate" } %>

  <!-- Hidden Preview Section (Initially Hidden) -->
  <div id="template_section" style="display: none;">
    <turbo-frame id="template_content"></turbo-frame>
    <button type="button" data-action="click->message#useTemplate">Use</button>
  </div>

  <div>
    <%= form.label :title, style: "display: block" %>
    <%= form.text_field :title %>
  </div>

  <div>
    <%= form.label :content, style: "display: block" %>
    <%= form.textarea :content, data: { message_target: "input" } %>
  </div>

  <div>
    <%= form.label :user, style: "display: block" %>
    <%= form.text_field :user %>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>
